<!--pages/order-manage/order-manage.wxml-->
<view class="container">
  <!-- 顶部操作栏 -->
  <view class="header-actions">
    <view class="order-type-tabs">
      <view class="tab-item {{orderType === 'sale' ? 'active' : ''}}" 
            bindtap="switchOrderType" data-type="sale">
        销售单
      </view>
      <view class="tab-item {{orderType === 'purchase' ? 'active' : ''}}" 
            bindtap="switchOrderType" data-type="purchase">
        采购单
      </view>
    </view>
    <view class="add-btn" bindtap="addOrder">
      <text class="icon">+</text>
      新增{{orderType === 'sale' ? '销售' : '采购'}}单
    </view>
  </view>

  <!-- 筛选栏 -->
  <view class="filter-bar">
    <picker mode="selector" range="{{statusOptions}}" value="{{statusIndex}}" 
            bindchange="onStatusChange">
      <view class="filter-item">
        <text>状态：{{statusOptions[statusIndex]}}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
    
    <picker mode="date" value="{{dateFilter}}" bindchange="onDateChange">
      <view class="filter-item">
        <text>日期：{{dateFilter || '全部'}}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
    
    <view class="search-box">
      <input placeholder="搜索订单号或客户" value="{{searchKeyword}}" 
             bindinput="onSearchInput" />
      <text class="search-icon">🔍</text>
    </view>
  </view>

  <!-- 订单列表 -->
  <scroll-view class="order-list" scroll-y="{{true}}" refresher-enabled="{{true}}"
               refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh"
               bindscrolltolower="loadMore">
    
    <view wx:if="{{orderList.length === 0}}" class="empty-state">
      <text class="empty-icon">📋</text>
      <text class="empty-text">暂无{{orderType === 'sale' ? '销售' : '采购'}}单</text>
      <view class="empty-action" bindtap="addOrder">
        新增{{orderType === 'sale' ? '销售' : '采购'}}单
      </view>
    </view>

    <movable-area wx:for="{{orderList}}" wx:key="id" class="order-item-area">
      <movable-view class="order-item-wrapper" direction="horizontal" 
                    damping="50" friction="2" out-of-bounds="true"
                    bindchange="onItemMove" data-index="{{index}}">
        
        <view class="order-item" bindtap="viewOrderDetail" data-order="{{item}}">
          <!-- 订单头部 -->
          <view class="order-header">
            <view class="order-info">
              <text class="order-number">{{item.orderNumber}}</text>
              <text class="order-date">{{item.createDate}}</text>
            </view>
            <view class="order-status status-{{item.status}}">
              {{item.statusText}}
            </view>
          </view>

          <!-- 客户/供应商信息 -->
          <view class="partner-info">
            <text class="partner-label">{{orderType === 'sale' ? '客户' : '供应商'}}：</text>
            <text class="partner-name">{{item.partnerName}}</text>
            <text class="contact-info">{{item.contactPhone}}</text>
          </view>

          <!-- 商品信息 -->
          <view class="products-info">
            <view wx:for="{{item.products}}" wx:for-item="product" wx:key="id" 
                  class="product-item">
              <text class="product-name">{{product.name}}</text>
              <text class="product-spec">{{product.specification}}</text>
              <text class="product-quantity">×{{product.quantity}}</text>
              <text class="product-price">¥{{product.price}}</text>
            </view>
            <view wx:if="{{item.products.length > 2}}" class="more-products">
              还有{{item.products.length - 2}}件商品...
            </view>
          </view>

          <!-- 订单金额 -->
          <view class="order-amount">
            <text class="amount-label">总金额：</text>
            <text class="amount-value">¥{{item.totalAmount}}</text>
          </view>
        </view>
      </movable-view>

      <!-- 左滑操作按钮 -->
      <view class="swipe-actions">
        <view class="action-btn edit" bindtap="editOrder" 
              data-order="{{item}}" catchtap="true">
          编辑
        </view>
        <view class="action-btn delete" bindtap="deleteOrder" 
              data-order="{{item}}" catchtap="true">
          删除
        </view>
      </view>
    </movable-area>

    <!-- 加载更多 -->
    <view wx:if="{{hasMore}}" class="load-more">
      <text>加载更多...</text>
    </view>
    <view wx:else class="no-more">
      <text>没有更多数据了</text>
    </view>
  </scroll-view>

  <!-- 底部统计 -->
  <view class="bottom-stats">
    <view class="stat-item">
      <text class="stat-label">今日{{orderType === 'sale' ? '销售' : '采购'}}</text>
      <text class="stat-value">{{todayStats.count}}单</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">今日金额</text>
      <text class="stat-value">¥{{todayStats.amount}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">本月{{orderType === 'sale' ? '销售' : '采购'}}</text>
      <text class="stat-value">{{monthStats.count}}单</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">本月金额</text>
      <text class="stat-value">¥{{monthStats.amount}}</text>
    </view>
  </view>
</view>