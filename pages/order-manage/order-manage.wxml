<!--pages/order-manage/order-manage.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="header-actions">
    <view class="order-type-tabs">
      <view class="tab-item {{orderType === 'sale' ? 'active' : ''}}" 
            bindtap="switchOrderType" data-type="sale">
        é”€å”®å•
      </view>
      <view class="tab-item {{orderType === 'purchase' ? 'active' : ''}}" 
            bindtap="switchOrderType" data-type="purchase">
        é‡‡è´­å•
      </view>
    </view>
    <view class="add-btn" bindtap="addOrder">
      <text class="icon">+</text>
      æ–°å¢{{orderType === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}å•
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <picker mode="selector" range="{{statusOptions}}" value="{{statusIndex}}" 
            bindchange="onStatusChange">
      <view class="filter-item">
        <text>çŠ¶æ€ï¼š{{statusOptions[statusIndex]}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    
    <picker mode="date" value="{{dateFilter}}" bindchange="onDateChange">
      <view class="filter-item">
        <text>æ—¥æœŸï¼š{{dateFilter || 'å…¨éƒ¨'}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    
    <view class="search-box">
      <input placeholder="æœç´¢è®¢å•å·æˆ–å®¢æˆ·" value="{{searchKeyword}}" 
             bindinput="onSearchInput" />
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y="{{true}}" refresher-enabled="{{true}}"
               refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh"
               bindscrolltolower="loadMore">
    
    <view wx:if="{{orderList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— {{orderType === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}å•</text>
      <view class="empty-action" bindtap="addOrder">
        æ–°å¢{{orderType === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}å•
      </view>
    </view>

    <movable-area wx:for="{{orderList}}" wx:key="id" class="order-item-area">
      <movable-view class="order-item-wrapper" direction="horizontal" 
                    damping="50" friction="2" out-of-bounds="true"
                    bindchange="onItemMove" data-index="{{index}}">
        
        <view class="order-item" bindtap="viewOrderDetail" data-order="{{item}}">
          <!-- è®¢å•å¤´éƒ¨ -->
          <view class="order-header">
            <view class="order-info">
              <text class="order-number">{{item.orderNumber}}</text>
              <text class="order-date">{{item.createDate}}</text>
            </view>
            <view class="order-status status-{{item.status}}">
              {{item.statusText}}
            </view>
          </view>

          <!-- å®¢æˆ·/ä¾›åº”å•†ä¿¡æ¯ -->
          <view class="partner-info">
            <text class="partner-label">{{orderType === 'sale' ? 'å®¢æˆ·' : 'ä¾›åº”å•†'}}ï¼š</text>
            <text class="partner-name">{{item.partnerName}}</text>
            <text class="contact-info">{{item.contactPhone}}</text>
          </view>

          <!-- å•†å“ä¿¡æ¯ -->
          <view class="products-info">
            <view wx:for="{{item.products}}" wx:for-item="product" wx:key="id" 
                  class="product-item">
              <text class="product-name">{{product.name}}</text>
              <text class="product-spec">{{product.specification}}</text>
              <text class="product-quantity">Ã—{{product.quantity}}</text>
              <text class="product-price">Â¥{{product.price}}</text>
            </view>
            <view wx:if="{{item.products.length > 2}}" class="more-products">
              è¿˜æœ‰{{item.products.length - 2}}ä»¶å•†å“...
            </view>
          </view>

          <!-- è®¢å•é‡‘é¢ -->
          <view class="order-amount">
            <text class="amount-label">æ€»é‡‘é¢ï¼š</text>
            <text class="amount-value">Â¥{{item.totalAmount}}</text>
          </view>
        </view>
      </movable-view>

      <!-- å·¦æ»‘æ“ä½œæŒ‰é’® -->
      <view class="swipe-actions">
        <view class="action-btn edit" bindtap="editOrder" 
              data-order="{{item}}" catchtap="true">
          ç¼–è¾‘
        </view>
        <view class="action-btn delete" bindtap="deleteOrder" 
              data-order="{{item}}" catchtap="true">
          åˆ é™¤
        </view>
      </view>
    </movable-area>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore}}" class="load-more">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>
    <view wx:else class="no-more">
      <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨ç»Ÿè®¡ -->
  <view class="bottom-stats">
    <view class="stat-item">
      <text class="stat-label">ä»Šæ—¥{{orderType === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}</text>
      <text class="stat-value">{{todayStats.count}}å•</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">ä»Šæ—¥é‡‘é¢</text>
      <text class="stat-value">Â¥{{todayStats.amount}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æœ¬æœˆ{{orderType === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}</text>
      <text class="stat-value">{{monthStats.count}}å•</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æœ¬æœˆé‡‘é¢</text>
      <text class="stat-value">Â¥{{monthStats.amount}}</text>
    </view>
  </view>
</view>