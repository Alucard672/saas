<!--pages/revenue-flow/revenue-flow.wxml-->
<scroll-view class="container" scroll-y="true" enable-back-to-top="true">
  <!-- 导航栏 -->
  <view class="nav-bar">
    <view class="nav-title">
      <text class="nav-emoji">💰</text>
      <text class="nav-text">收入流水</text>
    </view>
    <view class="nav-actions">
      <view class="nav-btn" bindtap="exportFlow">
        <linear-icon type="download" size="medium" weight="medium" color="secondary" class="nav-btn-icon"></linear-icon>
      </view>
    </view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 收入概览 -->
    <view class="revenue-overview fade-in">
      <view class="overview-card primary">
        <view class="overview-value">¥{{totalRevenue}}</view>
        <view class="overview-label">总收入</view>
        <linear-icon type="trend-up" size="large" weight="medium" color="primary" class="overview-icon"></linear-icon>
      </view>
      
      <view class="overview-stats">
        <view class="stat-item">
          <view class="stat-value">¥{{todayRevenue}}</view>
          <view class="stat-label">今日收入</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">¥{{weekRevenue}}</view>
          <view class="stat-label">本周收入</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">¥{{monthRevenue}}</view>
          <view class="stat-label">本月收入</view>
        </view>
      </view>
    </view>

    <!-- 筛选区域 -->
    <view class="filter-section fade-in" style="animation-delay: 0.1s;">
      <view class="filter-tabs">
        <view class="filter-tab {{timeFilter === 'today' ? 'active' : ''}}" data-filter="today" bindtap="onTimeFilterChange">
          <text class="tab-text">今日</text>
        </view>
        <view class="filter-tab {{timeFilter === 'week' ? 'active' : ''}}" data-filter="week" bindtap="onTimeFilterChange">
          <text class="tab-text">本周</text>
        </view>
        <view class="filter-tab {{timeFilter === 'month' ? 'active' : ''}}" data-filter="month" bindtap="onTimeFilterChange">
          <text class="tab-text">本月</text>
        </view>
        <view class="filter-tab {{timeFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="onTimeFilterChange">
          <text class="tab-text">全部</text>
        </view>
      </view>

      <!-- 支付方式筛选 -->
      <view class="payment-filter">
        <view class="payment-tab {{paymentFilter === 'all' ? 'active' : ''}}" data-payment="all" bindtap="onPaymentFilterChange">
          <text class="payment-text">全部</text>
        </view>
        <view class="payment-tab {{paymentFilter === '微信支付' ? 'active' : ''}}" data-payment="微信支付" bindtap="onPaymentFilterChange">
          <image src="/images/wechat-pay.png" class="payment-icon"></image>
          <text class="payment-text">微信</text>
        </view>
        <view class="payment-tab {{paymentFilter === '支付宝' ? 'active' : ''}}" data-payment="支付宝" bindtap="onPaymentFilterChange">
          <image src="/images/alipay.png" class="payment-icon"></image>
          <text class="payment-text">支付宝</text>
        </view>
        <view class="payment-tab {{paymentFilter === '现金' ? 'active' : ''}}" data-payment="现金" bindtap="onPaymentFilterChange">
          <image src="/images/cash-pay.png" class="payment-icon"></image>
          <text class="payment-text">现金</text>
        </view>
        <view class="payment-tab {{paymentFilter === '银行卡' ? 'active' : ''}}" data-payment="银行卡" bindtap="onPaymentFilterChange">
          <image src="/images/card-pay.png" class="payment-icon"></image>
          <text class="payment-text">银行卡</text>
        </view>
      </view>
    </view>

    <!-- 流水列表 -->
    <view class="flow-section fade-in" style="animation-delay: 0.2s;">
      <view class="section-header">
        <text class="section-title">收入明细</text>
        <text class="section-count">共 {{filteredFlows.length}} 笔</text>
      </view>

      <view class="flow-list" wx:if="{{filteredFlows.length > 0}}">
        <view class="flow-item" wx:for="{{filteredFlows}}" wx:key="id">
          <view class="flow-info">
            <view class="flow-header">
              <view class="flow-order">{{item.orderNo}}</view>
              <view class="flow-amount">+¥{{item.amount}}</view>
            </view>
            <view class="flow-details">
              <view class="flow-customer">{{item.customerName}}</view>
              <view class="flow-payment">
                <image src="{{getPaymentIcon(item.paymentMethod)}}" class="payment-method-icon"></image>
                <text class="payment-method-text">{{item.paymentMethod}}</text>
              </view>
            </view>
            <view class="flow-time">{{item.createTime}}</view>
          </view>
          <view class="flow-status {{item.status}}">
            <text class="status-text">{{getStatusText(item.status)}}</text>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-state" wx:else>
        <linear-icon type="receipt" size="xlarge" weight="light" color="secondary" class="empty-icon"></linear-icon>
        <text class="empty-title">暂无收入记录</text>
        <text class="empty-subtitle">当前筛选条件下没有找到收入记录</text>
      </view>
    </view>

    <!-- 统计图表区域 -->
    <view class="chart-section fade-in" style="animation-delay: 0.3s;">
      <view class="section-header">
        <text class="section-title">收入趋势</text>
        <text class="section-more" bindtap="goToDetailChart">详细图表</text>
      </view>
      
      <view class="chart-container">
        <canvas canvas-id="revenueChart" class="revenue-chart"></canvas>
      </view>
    </view>
  </view>
</scroll-view>