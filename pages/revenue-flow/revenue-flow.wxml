<!--pages/revenue-flow/revenue-flow.wxml-->
<scroll-view class="container" scroll-y="true" enable-back-to-top="true">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-title">
      <text class="nav-emoji">ğŸ’°</text>
      <text class="nav-text">æ”¶å…¥æµæ°´</text>
    </view>
    <view class="nav-actions">
      <view class="nav-btn" bindtap="exportFlow">
        <linear-icon type="download" size="medium" weight="medium" color="secondary" class="nav-btn-icon"></linear-icon>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- æ”¶å…¥æ¦‚è§ˆ -->
    <view class="revenue-overview fade-in">
      <view class="overview-card primary">
        <view class="overview-value">Â¥{{totalRevenue}}</view>
        <view class="overview-label">æ€»æ”¶å…¥</view>
        <linear-icon type="trend-up" size="large" weight="medium" color="primary" class="overview-icon"></linear-icon>
      </view>
      
      <view class="overview-stats">
        <view class="stat-item">
          <view class="stat-value">Â¥{{todayRevenue}}</view>
          <view class="stat-label">ä»Šæ—¥æ”¶å…¥</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">Â¥{{weekRevenue}}</view>
          <view class="stat-label">æœ¬å‘¨æ”¶å…¥</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">Â¥{{monthRevenue}}</view>
          <view class="stat-label">æœ¬æœˆæ”¶å…¥</view>
        </view>
      </view>
    </view>

    <!-- ç­›é€‰åŒºåŸŸ -->
    <view class="filter-section fade-in" style="animation-delay: 0.1s;">
      <view class="filter-tabs">
        <view class="filter-tab {{timeFilter === 'today' ? 'active' : ''}}" data-filter="today" bindtap="onTimeFilterChange">
          <text class="tab-text">ä»Šæ—¥</text>
        </view>
        <view class="filter-tab {{timeFilter === 'week' ? 'active' : ''}}" data-filter="week" bindtap="onTimeFilterChange">
          <text class="tab-text">æœ¬å‘¨</text>
        </view>
        <view class="filter-tab {{timeFilter === 'month' ? 'active' : ''}}" data-filter="month" bindtap="onTimeFilterChange">
          <text class="tab-text">æœ¬æœˆ</text>
        </view>
        <view class="filter-tab {{timeFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="onTimeFilterChange">
          <text class="tab-text">å…¨éƒ¨</text>
        </view>
      </view>

      <!-- æ”¯ä»˜æ–¹å¼ç­›é€‰ -->
      <view class="payment-filter">
        <view class="payment-tab {{paymentFilter === 'all' ? 'active' : ''}}" data-payment="all" bindtap="onPaymentFilterChange">
          <text class="payment-text">å…¨éƒ¨</text>
        </view>
        <view class="payment-tab {{paymentFilter === 'å¾®ä¿¡æ”¯ä»˜' ? 'active' : ''}}" data-payment="å¾®ä¿¡æ”¯ä»˜" bindtap="onPaymentFilterChange">
          <image src="/images/wechat-pay.png" class="payment-icon"></image>
          <text class="payment-text">å¾®ä¿¡</text>
        </view>
        <view class="payment-tab {{paymentFilter === 'æ”¯ä»˜å®' ? 'active' : ''}}" data-payment="æ”¯ä»˜å®" bindtap="onPaymentFilterChange">
          <image src="/images/alipay.png" class="payment-icon"></image>
          <text class="payment-text">æ”¯ä»˜å®</text>
        </view>
        <view class="payment-tab {{paymentFilter === 'ç°é‡‘' ? 'active' : ''}}" data-payment="ç°é‡‘" bindtap="onPaymentFilterChange">
          <image src="/images/cash-pay.png" class="payment-icon"></image>
          <text class="payment-text">ç°é‡‘</text>
        </view>
        <view class="payment-tab {{paymentFilter === 'é“¶è¡Œå¡' ? 'active' : ''}}" data-payment="é“¶è¡Œå¡" bindtap="onPaymentFilterChange">
          <image src="/images/card-pay.png" class="payment-icon"></image>
          <text class="payment-text">é“¶è¡Œå¡</text>
        </view>
      </view>
    </view>

    <!-- æµæ°´åˆ—è¡¨ -->
    <view class="flow-section fade-in" style="animation-delay: 0.2s;">
      <view class="section-header">
        <text class="section-title">æ”¶å…¥æ˜ç»†</text>
        <text class="section-count">å…± {{filteredFlows.length}} ç¬”</text>
      </view>

      <view class="flow-list" wx:if="{{filteredFlows.length > 0}}">
        <view class="flow-item" wx:for="{{filteredFlows}}" wx:key="id">
          <view class="flow-info">
            <view class="flow-header">
              <view class="flow-order">{{item.orderNo}}</view>
              <view class="flow-amount">+Â¥{{item.amount}}</view>
            </view>
            <view class="flow-details">
              <view class="flow-customer">{{item.customerName}}</view>
              <view class="flow-payment">
                <image src="{{getPaymentIcon(item.paymentMethod)}}" class="payment-method-icon"></image>
                <text class="payment-method-text">{{item.paymentMethod}}</text>
              </view>
            </view>
            <view class="flow-time">{{item.createTime}}</view>
          </view>
          <view class="flow-status {{item.status}}">
            <text class="status-text">{{getStatusText(item.status)}}</text>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:else>
        <linear-icon type="receipt" size="xlarge" weight="light" color="secondary" class="empty-icon"></linear-icon>
        <text class="empty-title">æš‚æ— æ”¶å…¥è®°å½•</text>
        <text class="empty-subtitle">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°æ”¶å…¥è®°å½•</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡å›¾è¡¨åŒºåŸŸ -->
    <view class="chart-section fade-in" style="animation-delay: 0.3s;">
      <view class="section-header">
        <text class="section-title">æ”¶å…¥è¶‹åŠ¿</text>
        <text class="section-more" bindtap="goToDetailChart">è¯¦ç»†å›¾è¡¨</text>
      </view>
      
      <view class="chart-container">
        <canvas canvas-id="revenueChart" class="revenue-chart"></canvas>
      </view>
    </view>
  </view>
</scroll-view>