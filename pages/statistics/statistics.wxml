<!--pages/statistics/statistics.wxml-->
<scroll-view class="container" scroll-y="true" enable-back-to-top="true">
  

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- æ—¶é—´é€‰æ‹©å™¨ -->
    <view class="time-selector fade-in">
      <view class="selector-tabs">
        <view class="time-tab {{timeRange === 'today' ? 'active' : ''}}" bindtap="setTimeRange" data-range="today">
          <text class="tab-text">ä»Šæ—¥</text>
        </view>
        <view class="time-tab {{timeRange === 'week' ? 'active' : ''}}" bindtap="setTimeRange" data-range="week">
          <text class="tab-text">æœ¬å‘¨</text>
        </view>
        <view class="time-tab {{timeRange === 'month' ? 'active' : ''}}" bindtap="setTimeRange" data-range="month">
          <text class="tab-text">æœ¬æœˆ</text>
        </view>
        <view class="time-tab {{timeRange === 'year' ? 'active' : ''}}" bindtap="setTimeRange" data-range="year">
          <text class="tab-text">æœ¬å¹´</text>
        </view>
      </view>
    </view>

    <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
    <view class="core-metrics fade-in" style="animation-delay: 0.1s;">
      <view class="metrics-primary">
        <view class="primary-metric">
          <linear-icon type="money" size="large" weight="medium" color="primary"></linear-icon>
          <view class="metric-content">
            <view class="metric-number">Â¥{{totalRevenue}}</view>
            <view class="metric-label">æ€»æ”¶å…¥</view>
            <view class="metric-trend {{revenueTrend >= 0 ? 'up' : 'down'}}">
              <linear-icon type="{{revenueTrend >= 0 ? 'trending-up' : 'trending-down'}}" size="small" weight="medium" color="{{revenueTrend >= 0 ? 'success' : 'danger'}}"></linear-icon>
              <text class="trend-text">{{revenueTrend >= 0 ? '+' : ''}}{{revenueTrend}}%</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="metrics-secondary">
        <view class="secondary-metric">
          <view class="metric-number">{{totalOrders}}</view>
          <view class="metric-label">è®¢å•æ•°é‡</view>
        </view>
        <view class="secondary-metric">
          <view class="metric-number">Â¥{{averageOrder}}</view>
          <view class="metric-label">å¹³å‡è®¢å•</view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†ç»Ÿè®¡ -->
    <view class="detailed-stats fade-in" style="animation-delay: 0.2s;">
      <view class="stats-grid">
        <view class="stat-card sales">
          <view class="card-header">
            <linear-icon type="chart" size="medium" weight="medium" color="primary"></linear-icon>
            <text class="card-title">é”€å”®ç»Ÿè®¡</text>
          </view>
          <view class="card-content">
            <view class="stat-item">
              <text class="stat-label">é”€å”®é¢</text>
              <text class="stat-value">Â¥{{salesAmount}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">åˆ©æ¶¦</text>
              <text class="stat-value profit">Â¥{{profit}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">åˆ©æ¶¦ç‡</text>
              <text class="stat-value">{{profitRate}}%</text>
            </view>
          </view>
        </view>
        
        <view class="stat-card inventory">
          <view class="card-header">
            <linear-icon type="package" size="medium" weight="medium" color="primary"></linear-icon>
            <text class="card-title">åº“å­˜ç»Ÿè®¡</text>
          </view>
          <view class="card-content">
            <view class="stat-item">
              <text class="stat-label">å•†å“æ€»æ•°</text>
              <text class="stat-value">{{totalProducts}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">åº“å­˜æ€»å€¼</text>
              <text class="stat-value">Â¥{{inventoryValue}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">é¢„è­¦å•†å“</text>
              <text class="stat-value warning">{{lowStockCount}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <view class="charts-section fade-in" style="animation-delay: 0.3s;">
      <view class="section-header">
        <text class="section-title">è¶‹åŠ¿åˆ†æ</text>
        <view class="chart-toggle">
          <view class="toggle-btn {{chartType === 'revenue' ? 'active' : ''}}" bindtap="setChartType" data-type="revenue">
            <text class="toggle-text">æ”¶å…¥</text>
          </view>
          <view class="toggle-btn {{chartType === 'orders' ? 'active' : ''}}" bindtap="setChartType" data-type="orders">
            <text class="toggle-text">è®¢å•</text>
          </view>
        </view>
      </view>
      
      <view class="chart-container">
        <view class="chart-placeholder">
          <linear-icon type="trending-up" size="large" weight="medium" color="primary"></linear-icon>
          <text class="chart-text">å›¾è¡¨æ•°æ®åŠ è½½ä¸­...</text>
          <text class="chart-subtitle">{{chartType === 'revenue' ? 'æ”¶å…¥è¶‹åŠ¿å›¾' : 'è®¢å•è¶‹åŠ¿å›¾'}}</text>
        </view>
      </view>
    </view>

    <!-- çƒ­é”€å•†å“ -->
    <view class="hot-products fade-in" style="animation-delay: 0.4s;">
      <view class="section-header">
        <text class="section-title">çƒ­é”€å•†å“</text>
        <text class="section-subtitle">TOP 5</text>
      </view>
      
      <view class="products-ranking" wx:if="{{hotProducts.length > 0}}">
        <view class="ranking-item" wx:for="{{hotProducts}}" wx:key="id">
          <view class="ranking-number {{index < 3 ? 'top' : ''}}">
            <text class="number-text">{{index + 1}}</text>
          </view>
          <view class="product-avatar">
            <text class="product-emoji">{{item.emoji}}</text>
          </view>
          <view class="product-details">
            <text class="product-name">{{item.name}}</text>
            <text class="product-sales">é”€é‡: {{item.salesCount}}</text>
          </view>
          <view class="product-revenue">
            <text class="revenue-value">Â¥{{item.revenue}}</text>
          </view>
        </view>
      </view>
      
      <view class="empty-state" wx:if="{{hotProducts.length === 0}}">
        <view class="empty-icon">ğŸ”¥</view>
        <text class="empty-title">æš‚æ— çƒ­é”€å•†å“</text>
        <text class="empty-subtitle">å¼€å§‹é”€å”®å•†å“åè¿™é‡Œä¼šæ˜¾ç¤ºçƒ­é”€æ’è¡Œ</text>
      </view>
    </view>

    <!-- å®¢æˆ·åˆ†æ -->
    <view class="customer-analysis fade-in" style="animation-delay: 0.5s;">
      <view class="section-header">
        <text class="section-title">å®¢æˆ·åˆ†æ</text>
      </view>
      
      <view class="analysis-grid">
        <view class="analysis-card">
          <view class="analysis-icon">ğŸ‘¥</view>
          <view class="analysis-content">
            <view class="analysis-number">{{totalCustomers}}</view>
            <view class="analysis-label">æ€»å®¢æˆ·æ•°</view>
          </view>
        </view>
        
        <view class="analysis-card">
          <view class="analysis-icon">ğŸ†•</view>
          <view class="analysis-content">
            <view class="analysis-number">{{newCustomers}}</view>
            <view class="analysis-label">æ–°å¢å®¢æˆ·</view>
          </view>
        </view>
        
        <view class="analysis-card">
          <linear-icon type="sync" size="medium" weight="medium" color="primary"></linear-icon>
          <view class="analysis-content">
            <view class="analysis-number">{{repeatCustomers}}</view>
            <view class="analysis-label">å›å¤´å®¢</view>
          </view>
        </view>
        
        <view class="analysis-card">
          <linear-icon type="star" size="medium" weight="medium" color="primary"></linear-icon>
          <view class="analysis-content">
            <view class="analysis-number">Â¥{{avgCustomerValue}}</view>
            <view class="analysis-label">å®¢æˆ·å‡å€¼</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</scroll-view>