<!--pages/unit-edit/unit-edit.wxml-->
<view class="container">
  <view class="main-content">
    <!-- 原始数据参考区域 -->
    <view class="reference-section" wx:if="{{isEdit && originalData}}">
      <view class="reference-header">
        <text class="reference-title">原始数据参考</text>
      </view>
      <view class="reference-content">
        <view class="reference-item">
          <text class="reference-label">单位名称:</text>
          <text class="reference-value">{{originalData.name}}</text>
        </view>
        <view class="reference-item" wx:if="{{originalData.symbol}}">
          <text class="reference-label">单位符号:</text>
          <text class="reference-value">{{originalData.symbol}}</text>
        </view>
        <view class="reference-item" wx:if="{{originalData.description}}">
          <text class="reference-label">单位描述:</text>
          <text class="reference-value">{{originalData.description}}</text>
        </view>
        <view class="reference-item">
          <text class="reference-label">基础单位:</text>
          <text class="reference-value">{{originalData.isBase ? '是' : '否'}}</text>
        </view>
        <view class="reference-item">
          <text class="reference-label">创建时间:</text>
          <text class="reference-value">{{originalData.createTime}}</text>
        </view>
      </view>
    </view>

    <!-- 编辑表单区域 -->
    <scroll-view class="form-container" scroll-y="true" enable-back-to-top="true">
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">编辑信息</text>
          <text class="section-desc">请修改需要更新的字段</text>
        </view>

        <view class="form-content">
          <!-- 单位名称 -->
          <view class="form-group">
            <view class="form-label-row">
              <text class="form-label required">单位名称</text>
              <text class="char-count">{{formData.name.length}}/10</text>
            </view>
            <input 
              class="form-input {{errors.name ? 'error' : ''}}"
              placeholder="请输入单位名称"
              value="{{formData.name}}"
              bindinput="onFormInput"
              data-field="name"
              maxlength="10"
              focus="{{!isEdit}}"
            />
            <view class="input-hint" wx:if="{{!errors.name}}">
              <text>单位的标准名称，如：千克、米、个等</text>
            </view>
            <view class="error-text" wx:if="{{errors.name}}">
              <text class="error-icon">⚠</text>
              <text>{{errors.name}}</text>
            </view>
          </view>

          <!-- 单位符号 -->
          <view class="form-group">
            <view class="form-label-row">
              <text class="form-label">单位符号</text>
              <text class="char-count">{{formData.symbol.length}}/5</text>
            </view>
            <input 
              class="form-input {{errors.symbol ? 'error' : ''}}"
              placeholder="请输入单位符号（如：kg、m、个）"
              value="{{formData.symbol}}"
              bindinput="onFormInput"
              data-field="symbol"
              maxlength="5"
            />
            <view class="input-hint" wx:if="{{!errors.symbol}}">
              <text>单位的简写符号，便于快速识别</text>
            </view>
            <view class="error-text" wx:if="{{errors.symbol}}">
              <text class="error-icon">⚠</text>
              <text>{{errors.symbol}}</text>
            </view>
          </view>

          <!-- 单位描述 -->
          <view class="form-group">
            <view class="form-label-row">
              <text class="form-label">单位描述</text>
              <text class="char-count">{{formData.description.length}}/50</text>
            </view>
            <textarea 
              class="form-textarea {{errors.description ? 'error' : ''}}"
              placeholder="请输入单位描述（可选）"
              value="{{formData.description}}"
              bindinput="onFormInput"
              data-field="description"
              maxlength="50"
              auto-height
            ></textarea>
            <view class="input-hint" wx:if="{{!errors.description}}">
              <text>详细描述单位的用途和特点</text>
            </view>
            <view class="error-text" wx:if="{{errors.description}}">
              <text class="error-icon">⚠</text>
              <text>{{errors.description}}</text>
            </view>
          </view>

          <!-- 基础单位设置 -->
          <view class="form-group">
            <text class="form-label">基础单位设置</text>
            <view class="checkbox-container">
              <label class="checkbox-item">
                <checkbox 
                  value="isBase" 
                  checked="{{formData.isBase}}"
                  bindchange="onCheckboxChange"
                  color="#007AFF"
                />
                <view class="checkbox-content">
                  <text class="checkbox-label">设为基础单位</text>
                  <text class="checkbox-desc">基础单位用于换算关系的基准</text>
                </view>
              </label>
            </view>
            <view class="input-hint">
              <text>基础单位在换算关系中作为标准参考</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 变更对比区域 -->
      <view class="changes-section" wx:if="{{isEdit && originalData}}">
        <view class="section-header">
          <text class="section-title">变更对比</text>
          <text class="section-desc">高亮显示已修改的字段</text>
        </view>
        
        <view class="changes-content">
          <view class="change-item {{formData.name !== originalData.name ? 'changed' : ''}}">
            <text class="change-label">单位名称:</text>
            <view class="change-values">
              <text class="old-value">{{originalData.name}}</text>
              <text class="arrow" wx:if="{{formData.name !== originalData.name}}">→</text>
              <text class="new-value {{formData.name !== originalData.name ? 'highlight' : ''}}">{{formData.name}}</text>
            </view>
          </view>

          <view class="change-item {{formData.symbol !== originalData.symbol ? 'changed' : ''}}">
            <text class="change-label">单位符号:</text>
            <view class="change-values">
              <text class="old-value">{{originalData.symbol || '无'}}</text>
              <text class="arrow" wx:if="{{formData.symbol !== originalData.symbol}}">→</text>
              <text class="new-value {{formData.symbol !== originalData.symbol ? 'highlight' : ''}}">{{formData.symbol || '无'}}</text>
            </view>
          </view>

          <view class="change-item {{formData.description !== originalData.description ? 'changed' : ''}}">
            <text class="change-label">单位描述:</text>
            <view class="change-values">
              <text class="old-value">{{originalData.description || '无'}}</text>
              <text class="arrow" wx:if="{{formData.description !== originalData.description}}">→</text>
              <text class="new-value {{formData.description !== originalData.description ? 'highlight' : ''}}">{{formData.description || '无'}}</text>
            </view>
          </view>

          <view class="change-item {{formData.isBase !== originalData.isBase ? 'changed' : ''}}">
            <text class="change-label">基础单位:</text>
            <view class="change-values">
              <text class="old-value">{{originalData.isBase ? '是' : '否'}}</text>
              <text class="arrow" wx:if="{{formData.isBase !== originalData.isBase}}">→</text>
              <text class="new-value {{formData.isBase !== originalData.isBase ? 'highlight' : ''}}">{{formData.isBase ? '是' : '否'}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- 底部操作栏 -->
    <view class="bottom-actions">
      <view class="action-buttons">
        <view class="btn btn-secondary" bindtap="cancelEdit">
          <text class="btn-icon">✕</text>
          <text>取消</text>
        </view>
        <view class="btn btn-primary {{submitting ? 'loading' : ''}}" bindtap="saveUnit">
          <text class="btn-icon" wx:if="{{!submitting}}">✓</text>
          <text class="loading-icon" wx:if="{{submitting}}">⟳</text>
          <text>{{submitting ? '保存中...' : '保存'}}</text>
        </view>
      </view>
    </view>
  </view>
</view>