<!--pages/sales/sales.wxml-->
<view class="container">
  <view class="main-content">
    <!-- 搜索和筛选区域 -->
    <view class="search-filter-section">
      <!-- 搜索框 -->
      <view class="search-container">
        <view class="search-box">
          <linear-icon type="search" size="medium" weight="medium" color="primary"></linear-icon>
          <input 
            class="search-input" 
            placeholder="搜索订单号、客户姓名或电话"
            value="{{searchKeyword}}"
            bindinput="onSearchInput"
          />
        </view>
      </view>

      <!-- 筛选标签 -->
      <view class="filter-tabs">
        <view 
          class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
          data-filter="all"
          bindtap="selectFilter"
        >
          <text class="tab-text">全部</text>
        </view>
        <view 
          class="filter-tab {{currentFilter === 'completed' ? 'active' : ''}}"
          data-filter="completed"
          bindtap="selectFilter"
        >
          <text class="tab-text">已完成</text>
        </view>
        <view 
          class="filter-tab {{currentFilter === 'pending' ? 'active' : ''}}"
          data-filter="pending"
          bindtap="selectFilter"
        >
          <text class="tab-text">待处理</text>
        </view>
        <view 
          class="filter-tab {{currentFilter === 'cancelled' ? 'active' : ''}}"
          data-filter="cancelled"
          bindtap="selectFilter"
        >
          <text class="tab-text">已取消</text>
        </view>
        <view 
          class="filter-tab"
          bindtap="selectTimeFilter"
        >
          <text class="tab-text">时间筛选</text>
        </view>
      </view>
    </view>

    <!-- 统计概览 -->
    <view class="stats-overview">
      <view class="overview-card primary">
        <linear-icon type="money" size="large" weight="medium" color="primary"></linear-icon>
        <view class="overview-content">
          <view class="overview-number">¥{{totalSales}}</view>
          <view class="overview-label">总销售额</view>
        </view>
      </view>
      <view class="overview-mini">
        <view class="mini-card">
          <view class="mini-number">¥{{todaySales}}</view>
          <view class="mini-label">今日</view>
        </view>
        <view class="mini-card">
          <view class="mini-number">¥{{weekSales}}</view>
          <view class="mini-label">本周</view>
        </view>
        <view class="mini-card">
          <view class="mini-number">¥{{monthSales}}</view>
          <view class="mini-label">本月</view>
        </view>
      </view>
    </view>

    <!-- 销售单列表区域 -->
    <view class="sales-section">
      <view class="section-header">
        <text class="section-title">销售单列表</text>
        <text class="section-count">共 {{filteredSales.length}} 单</text>
      </view>

      <!-- 销售单列表 -->
      <scroll-view class="sales-list" scroll-y="true" enhanced="true">
        <view wx:if="{{filteredSales.length > 0}}">
          <view 
            wx:for="{{filteredSales}}" 
            wx:key="id" 
            class="sale-item-wrapper fade-in"
            style="animation-delay: {{index * 0.1}}s"
          >
            <!-- 销售单主体 -->
            <view 
              class="sale-item {{swipeItems[item.id] ? 'swiped' : ''}}"
              data-id="{{item.id}}"
              bindtouchstart="onTouchStart"
              bindtouchmove="onTouchMove"
              bindtouchend="onTouchEnd"
              bindtap="onSaleTap"
            >
              <!-- 状态指示器 -->
              <view class="status-indicator {{item.status === 'completed' ? 'normal' : item.status === 'pending' ? 'warning' : 'danger'}}"></view>
              
              <view class="sale-content">
                <!-- 销售单头部 -->
                <view class="sale-header">
                  <view class="sale-avatar">
                    <linear-icon type="list" size="medium" weight="medium" color="primary"></linear-icon>
                  </view>
                  <view class="sale-basic">
                    <text class="sale-order">{{item.orderNo}}</text>
                    <text class="sale-customer">{{item.customer}}</text>
                    <text class="sale-phone">{{item.phone}}</text>
                  </view>
                  <view class="sale-status">
                    <text class="status-text {{item.status}}">
                      {{item.status === 'completed' ? '已完成' : item.status === 'pending' ? '待处理' : '已取消'}}
                    </text>
                  </view>
                </view>

                <!-- 销售单信息 -->
                <view class="sale-info">
                  <view class="info-row">
                    <view class="info-item">
                      <text class="info-label">金额</text>
                      <text class="info-value price">¥{{item.totalAmount}}</text>
                    </view>
                    <view class="info-item">
                      <text class="info-label">支付</text>
                      <view class="payment-info">
                        <image 
                          class="payment-icon" 
                          src="{{item.paymentMethod === '微信支付' ? '/images/wechat-pay.png' : item.paymentMethod === '支付宝' ? '/images/alipay.png' : item.paymentMethod === '现金' ? '/images/cash-pay.png' : '/images/card-pay.png'}}" 
                          mode="aspectFit"
                        ></image>
                        <text class="info-value">{{item.paymentMethod}}</text>
                      </view>
                    </view>
                  </view>
                  <view class="info-row">
                    <view class="info-item">
                      <text class="info-label">商品数</text>
                      <text class="info-value">{{item.items.length}}种</text>
                    </view>
                    <view class="info-item">
                      <text class="info-label">时间</text>
                      <text class="info-value">{{item.createTime}}</text>
                    </view>
                  </view>
                </view>
              </view>
            </view>

            <!-- 左滑操作按钮 -->
            <view class="swipe-actions {{swipeItems[item.id] ? 'show' : ''}}">
              <view 
                class="action-btn edit"
                data-id="{{item.id}}"
                bindtap="editSale"
              >
                <linear-icon type="edit" size="small" weight="medium" color="primary"></linear-icon>
                <text class="action-text">编辑</text>
              </view>
              <view 
                class="action-btn delete"
                data-id="{{item.id}}"
                bindtap="deleteSale"
              >
                <linear-icon type="delete" size="small" weight="medium" color="danger"></linear-icon>
                <text class="action-text">删除</text>
              </view>
            </view>
          </view>
        </view>

        <!-- 空状态 -->
        <view wx:else class="empty-state">
          <linear-icon type="list" size="large" weight="medium" color="muted"></linear-icon>
          <text class="empty-title">暂无销售记录</text>
          <text class="empty-subtitle">点击右下角按钮添加第一个销售单</text>
          <view class="empty-action" bindtap="addSale">
            <text class="action-text">立即添加</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 底部安全区域 -->
    <view class="bottom-safe-area"></view>
  </view>

  <!-- 浮动添加按钮 -->
  <view class="fab" bindtap="addSale">
    <text class="fab-icon">+</text>
  </view>
</view>